# Default configuration for scalpel-cli
# NOTE: For production deployments, override settings using environment variables
# (e.g., SCALPEL_POSTGRES_URL) or a config.local.yaml file.

logger:
  service_name: "scalpel-cli"
  log_file: "logs/scalpel.log"
  level: "info" # Production default. Use 'debug' for troubleshooting.
  format: "json" # Production default (structured logging). Use 'console' for development.
  add_source: false # Disabled for production performance.
  max_size: 10
  max_backups: 3
  max_age: 7
  compress: true
  colors:
    debug: "cyan"
    info: "green"
    warn: "yellow"
    error: "red"
    dpanic: "magenta"
    panic: "magenta"
    fatal: "magenta"

postgres:
  # The database URL must be configured before running.
  # Recommended to set via SCALPEL_POSTGRES_URL environment variable.
  # Example: postgres://user:password@hostname:5432/scalpeldb?sslmode=require
  url: ""

engine:
  queue_size: 1000
  worker_concurrency: 8
  default_task_timeout: "15m"

browser:
  headless: false
  ignore_tls_errors: false # Keep false for production security.
  args:
    - "--no-sandbox"
    - "--disable-setuid-sandbox"
    - "--disable-dev-shm-usage"
    - "--disable-gpu"
  viewport:
    width: 1920
    height: 1080

network:
  timeout: "30s"
  postLoadWait: "2s" # Wait 2 seconds for JS to settle after page load
  headers:
    User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36 ScalpelV2/1.0"

# -- Agent Configuration --
agent:
  knowledge_graph:
    type: "in-memory" # Options: "postgres" or "in-memory"

# IAST script paths required by the browser manager (relative to working directory)
iast:
  shimPath: "internal/browser/shim/pinnacle.js"
  configPath: "internal/browser/shim/pinnacle.json"

# -- scanner module configuration --
scanners:
  passive:
    headers:
      enabled: true

  static:
    jwt:
      enabled: true
      # Removed weak default secrets. Users should provide their own list if needed.
      known_secrets: []
      brute_force_enabled: true
      # Changed path from "~/SecLists/..." to a relative path.
      # Ensure this file is available in the deployment environment.
      dictionary_file: "config/jwt.secrets.list"

  active:
    taint:
      enabled: true
      depth: 3
      concurrency: 2
    protopollution:
      enabled: true
    timeslip: # Race Condition Analyzer
      enabled: true
      request_count: 25
      max_concurrency: 10
      threshold_ms: 500
    auth:
      # -- This is the updated ATO configuration section --
      ato:
        enabled: true
        credentialFile: "" # Leaving empty uses the internal default list
        concurrency: 4
        minRequestDelayMs: 500    # 0.5s base delay between requests per worker
        requestDelayJitterMs: 500 # Add up to 0.5s of random delay

        # Keywords for response analysis
        successKeywords:
          - "welcome"
          - "redirect"
          - "dashboard"
          - "logout"
          - '"success":true'
        userFailureKeywords:
          - "user not found"
          - "invalid user"
          - "no such account"
          - "user does not exist"
        passFailureKeywords:
          - "invalid password"
          - "incorrect password"
          - "authentication failed"
        genericFailureKeywords:
          - "login failed"
          - "invalid credentials"
        lockoutKeywords:
          - "account locked"
          - "too many attempts"

    idor:
      enabled: true
      ignore_list:
        - "csrf_token"
        - "X-CSRF-Token"
        - "nonce"
        - "viewstate"
      test_strategies:
        NumericID: ["increment", "decrement"]
        UUID: ["horizontal_swap"]
        Base64Encoded: ["bit_flip"]
        ObjectID: ["increment_char"]